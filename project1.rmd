---
title: "Project 1"
author: "James Eapen"
date: "2021 Oct 4"
output: 
    html_document: 
        theme: sandstone
        highlight: espresso
---

## Assignment tracker {.tabset}

[source](https://github.com/jamespeapen/expdesign/blob/gh-pages/project1.rmd)

### Setup

```{r setup, message=FALSE}
library("tidyverse")
library("lubridate")
library("ggplot2")
library("RColorBrewer")
```

### Data loading

```{r data_loading, message=FALSE}
sheets_url <- "https://docs.google.com/spreadsheets/d/1bJw_ad0PLQmLe4RvmRzsVnrOF-9Z9Xth9GTSdwO8B4M"
googlesheets4::gs4_deauth()
raw_data <- googlesheets4::read_sheet(sheets_url)

# rename columns
colnames(raw_data)  <- c("timestamp",
                      "ID",
                      "assignment",
                      "start_time",
                      "end_time",
                      "comments")
```

### Cleanup {.tabset}

#### IDs

Find out how many IDs there are with counts.

```{r}
table(raw_data$ID) %>% knitr::kable()
```

FooBarBazQux is Tim so I'll remove that row of data.

```{r}
raw_data %>% filter(ID != "FooBarBazQux") -> raw_data
```

T-rex has two IDs so replace "T-Rex" with "T-rex" to be consistent.

```{r}
# piped object can be accessed with .
raw_data$ID %>% replace(. == "T-Rex", "T-rex") -> raw_data$ID
table(raw_data$ID) %>% knitr::kable()
```


#### Assignments

```{r}
raw_data$assignment %>% table() %>% sort() %>% knitr::kable()
```

`assignment` has `r length(unique(raw_data$assignment))` unique elements and is
much messier so I'll start with the assignments with somewhat consistent
words in their names. Since some assignments have 'Git' and 'Project
Management' occurring consistently, I'll use regular expressions to find all
the rows with 'Git' or 'Project Management' and replace them with "Using Git
from RStudio" and "Project Management with RStudio".

`.*` in regex means match anything, so it'll match any string as long as it has
'git' or 'project management'. This will be case-insensitive matching.


```{r}
#'?' matches whether there is a space before git or not
raw_data$assignment %>%
    sub(".* ?git .*", "Using Git from RStudio", ., ignore.case = TRUE) ->
        raw_data$assignment

raw_data$assignment %>%
    sub(".*project management.*", "Project Management with RStudio", .,
        ignore.case = TRUE) -> raw_data$assignment

raw_data$assignment %>% table() %>% sort() %>% knitr::kable()
```

There are now `r length(unique(raw_data$assignment))` unique assignment names.

And again by matching for any occurrences of '23', '24', and '29' in the same
string. I'll be adding the 'Reading' and 'Lab' prefixes to better organize the
data.

```{r}
raw_data$assignment %>%
    sub(".*23.*24.*29.*", "Reading: Experimental Design for Biologists Ch. 23, 24, 29", .,
        ignore.case = TRUE) -> raw_data$assignment

raw_data$assignment %>% table() %>% sort() %>% knitr::kable()
```

There are now `r length(unique(raw_data$assignment))` unique assignment names.

Getting Ch. 2 and 3 labs and chapter 6 reading is a little more complex. Chaper 3
matches needs two patterns separated by `|` to match both:

```{r}
raw_data$assignment %>%
    sub(".*Ch(apter)? ?2.*(assignment|lab).*", "Lab: ISLRv2 Chapter 2", .,
        ignore.case = TRUE) -> raw_data$assignment

raw_data$assignment %>% table() %>% sort() %>% knitr::kable()

raw_data$assignment %>%
    sub(".*Ch.*3.*lab.*|.*3.6.*", "Lab: ISLRv2 Chapter 3", .,
        ignore.case = TRUE) -> raw_data$assignment

raw_data$assignment %>% table() %>% sort() %>% knitr::kable()

raw_data$assignment %>%
    sub(".*Ch(apter)?.? ?6.*", "Reading: ISLRv2 Chapter 6", .,
        ignore.case = TRUE) -> raw_data$assignment

raw_data$assignment %>% table() %>% sort() %>% knitr::kable()
```

Now with those collected there are `r length(unique(raw_data$assignment))`
assignments.


### Data exploration {.tabset}

#### Datatable

```{r duration, message=FALSE}
# get durations
raw_data %>% mutate(duration = as.numeric(end_time - start_time)) -> assignments
DT::datatable(assignments)
```

#### Number of assignments done per person

```{r exploration}
assignments %>%
    ggplot(aes(x = forcats::fct_infreq(ID))) + # forcats::fct_infreq sorts the IDs by count
    geom_bar(stat = "count") +
    xlab("ID") +
    theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```

#### Time taken per person

```{r time_person, fig.width=15, fig.height=10}
# filter for durations > 0 since the duration calc got negatives
nonz_durations <- assignments %>% subset(duration > 0)
nonz_durations %>%
    ggplot(aes(x = reorder(ID, duration), y = duration)) +
    geom_boxplot() +
    geom_jitter(aes(color = assignment)) +
    xlab("ID") +
    theme(legend.position = "bottom",
          axis.text.y = element_text(size = 12)) +
    coord_flip()
```

#### Time taken per assignment

```{r time_assignment, fig.width=14, fig.height=10}
nonz_durations %>%
    ggplot(aes(x = reorder(assignment, duration), y = duration)) +
    geom_boxplot() +
    geom_jitter(aes(color = ID)) +
    xlab("assignment") +
    theme(legend.position = "bottom",
          axis.text.y = element_text(size = 12)) +
    coord_flip()
```

### Session Info

```{r}
sessionInfo()
```

